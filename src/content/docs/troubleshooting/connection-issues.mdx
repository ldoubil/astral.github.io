---
title: 连接问题
description: 解决 Astral 网络连接相关的各种问题
sidebar:
  order: 2
---

import { Steps, Aside, Tabs, TabItem, Card, CardGrid } from '@astrojs/starlight/components';

# 🌐 连接问题排除

网络连接是 Astral 最核心的功能，本章将帮助您解决各种连接相关的问题。

## 🚨 常见连接问题

<CardGrid>
  <Card title="🔴 无法连接服务器" icon="warning">
    客户端无法连接到任何服务器
  </Card>
  <Card title="👥 看不到其他成员" icon="puzzle">
    连接成功但房间内看不到其他用户
  </Card>
  <Card title="⚡ 连接不稳定" icon="lightning">
    频繁断线或连接质量差
  </Card>
  <Card title="🐌 网络延迟过高" icon="clock">
    延迟过高影响使用体验
  </Card>
</CardGrid>

## 🔴 无法连接服务器

### 问题诊断步骤

<Steps>
1. **检查基础网络连接**
   ```bash
   # 测试基本网络连通性
   ping 8.8.8.8
   
   # 测试 DNS 解析
   nslookup baidu.com
   ```

2. **检查防火墙设置**
   - Windows：完全关闭 Windows Defender 防火墙
   - 第三方安全软件：添加 Astral 到白名单
   - 路由器：检查是否有特殊限制

3. **测试服务器连通性**
   ```bash
   # 测试服务器端口
   telnet public.easytier.top 11010
   
   # 或使用 PowerShell (Windows)
   Test-NetConnection -ComputerName public.easytier.top -Port 11010
   ```

4. **检查网络环境**
   - 校园网/公司网络：询问网管是否有端口限制
   - 校园网：可能需要认证或有访问限制
   - 移动网络：某些运营商可能限制 P2P 连接
</Steps>

### 解决方案

<Tabs>
  <TabItem label="防火墙问题">
    **Windows 防火墙完全关闭**：
    <Steps>
    1. 打开"Windows 安全中心"
    2. 选择"防火墙和网络保护"
    3. 分别关闭"域网络"、"专用网络"、"公用网络"的防火墙
    4. 重启 Astral 应用
    </Steps>

    **第三方安全软件设置**：
    - **360 安全卫士**：木马防火墙 → 信任列表 → 添加 Astral
    - **腾讯电脑管家**：实时防护 → 信任区 → 添加程序
    - **火绒安全**：防护中心 → 访问控制 → 信任列表
  </TabItem>

  <TabItem label="网络环境问题">
    **校园网/受限网络**：
    - 联系网络管理员开放端口 11010
    - 尝试使用手机热点测试
    - 考虑使用其他网络环境

    **运营商限制**：
    - 更换不同的服务器尝试
    - 联系运营商询问 P2P 策略
    - 考虑升级到商业宽带

    **路由器设置**：
    ```bash
    # 检查路由器是否开启 UPnP
    # 在路由器管理界面：
    # 1. 启用 UPnP 功能
    # 2. 关闭 SPI 防火墙
    # 3. 设置 DMZ 主机（高级用户）
    ```
  </TabItem>

  <TabItem label="软件配置问题">
    **重置网络配置**：
    <Steps>
    1. 完全关闭 Astral
    2. 删除配置文件：
       - Windows: `%APPDATA%/Astral/`
       - Linux: `~/.config/astral/`
       - Android: 应用设置 → 存储 → 清除数据
    3. 重新启动应用
    4. 重新配置网络设置
    </Steps>

    **网络适配器重置**：
    ```powershell
    # Windows 网络重置命令
    netsh winsock reset
    netsh int ip reset
    ipconfig /release
    ipconfig /renew
    ipconfig /flushdns
    ```
  </TabItem>
</Tabs>

## 👥 房间内看不到其他成员

### 常见原因分析

**服务器不一致**：
- 👥 **问题**：不同用户选择了不同的服务器
- 🔧 **解决**：确保所有成员选择相同的服务器地址

**房间信息错误**：
- 🔑 **问题**：房间号或密码输入错误
- 🔧 **解决**：重新确认房间信息，区分大小写

**网络连接质量**：
- 📡 **问题**：网络延迟过高或不稳定
- 🔧 **解决**：更换网络环境或服务器

### 详细排查步骤

<Steps>
1. **验证基础连接**
   - 确认 Astral 显示"已连接"状态
   - 检查房间页面是否显示"本机"信息

2. **核对服务器设置**
   ```bash
   # 在房间页面对比服务器地址
   # 确保格式如：public.easytier.top:11010
   # 所有成员必须完全一致
   ```

3. **测试网络连通性**
   ```bash
   # 在命令行测试虚拟网络连通性
   ping 10.126.126.1
   
   # 如果能 ping 通说明网络层面正常
   # 如果不通则需要检查网络配置
   ```

4. **检查防火墙和安全软件**
   - 确保所有成员都已关闭防火墙
   - 检查是否有安全软件拦截网络连接
</Steps>

### 解决方案

<Tabs>
  <TabItem label="服务器同步">
    **统一服务器选择**：
    <Steps>
    1. 所有成员进入"服务器"页面
    2. 点击地球图标查看当前选择的服务器
    3. 记录完整的服务器地址（包括端口号）
    4. 如果不一致，选择相同的服务器
    5. 确保都点击了"启用"按钮
    6. 重新连接房间
    </Steps>

    **推荐服务器选择策略**：
    - 房主选择延迟最低的服务器
    - 将服务器地址发送给所有成员
    - 所有人切换到相同服务器后再连接
  </TabItem>

  <TabItem label="房间重建">
    **重新创建房间**：
    <Steps>
    1. 房主退出当前房间
    2. 删除现有房间配置
    3. 重新创建房间，设置新的房间号
    4. 确保所有成员使用新的房间信息
    5. 逐个连接测试，确认每个人都能看到
    </Steps>

    **房间配置最佳实践**：
    - 使用简单的房间号（如：12345）
    - 设置容易记忆的密码
    - 避免使用特殊字符
    - 确保房间名称不包含中文
  </TabItem>
</Tabs>

## ⚡ 连接不稳定问题

### 症状表现

- 🔄 频繁自动重连
- ⏸️ 连接时断时续
- 🐌 数据传输中断
- ❌ 游戏或应用突然断线

### 原因分析与解决

<Tabs>
  <TabItem label="网络环境问题">
    **WiFi 信号不稳定**：
    - 靠近路由器或使用有线连接
    - 更换 5GHz 频段（如果支持）
    - 检查是否有信号干扰源

    **网络带宽不足**：
    - 关闭其他占用带宽的应用
    - 暂停下载或流媒体服务
    - 考虑升级网络套餐

    **运营商网络问题**：
    ```bash
    # 测试网络稳定性
    ping -t 8.8.8.8
    
    # 查看丢包率和延迟波动
    # 如果丢包率>5%或延迟波动>100ms说明网络不稳定
    ```
  </TabItem>

  <TabItem label="服务器选择优化">
    **服务器延迟测试**：
    ```bash
    # 测试不同服务器的延迟
    ping public.easytier.top
    ping turn.sc.629957.xyz
    ping sh.993555.xyz
    
    # 选择延迟最低且最稳定的服务器
    ```

    **服务器负载考虑**：
    - 避开网络高峰期（晚上8-11点）
    - 选择地理位置更近的服务器
    - 尝试新加入的服务器（通常负载较低）
  </TabItem>

  <TabItem label="应用配置优化">
    **启用稳定性增强**：
    - 在设置中开启"延迟优先"
    - 同时启用 TCP 和 UDP 协议
    - 增加连接超时时间

    **系统资源优化**：
    - 关闭不必要的后台程序
    - 确保系统内存充足
    - 使用性能模式而非节能模式
  </TabItem>
</Tabs>

## 🐌 网络延迟过高

### 延迟标准参考

| 延迟范围 | 体验质量 | 适用场景 |
|----------|----------|----------|
| 0-30ms | 优秀 | 竞技游戏、实时协作 |
| 30-60ms | 良好 | 一般游戏、文件共享 |
| 60-100ms | 一般 | 文档编辑、轻度使用 |
| 100ms+ | 较差 | 仅适合非实时应用 |

### 延迟优化策略

<Steps>
1. **选择最优服务器**
   ```bash
   # 测试所有可用服务器的延迟
   for server in public.easytier.top turn.sc.629957.xyz sh.993555.xyz; do
       echo "Testing $server:"
       ping -c 4 $server
   done
   ```

2. **网络路径优化**
   - 使用有线网络连接
   - 关闭 VPN 或代理服务
   - 检查路由器是否启用 QoS

3. **应用设置调优**
   - 启用"延迟优先"模式
   - 关闭数据压缩（在低延迟场景下）
   - 调整缓冲区大小

4. **系统级优化**
   ```powershell
   # Windows TCP 优化
   netsh int tcp set global autotuninglevel=normal
   netsh int tcp set global chimney=enabled
   netsh int tcp set global rss=enabled
   ```
</Steps>

## 🔧 高级网络诊断

### 网络连通性完整测试

```bash
#!/bin/bash
# network-test.sh - 完整的网络诊断脚本

echo "=== Astral 网络诊断 ==="

# 1. 基础连通性测试
echo "1. 测试基础网络连通性..."
ping -c 3 8.8.8.8

# 2. DNS 解析测试
echo "2. 测试 DNS 解析..."
nslookup public.easytier.top

# 3. 服务器连通性测试
echo "3. 测试 Astral 服务器..."
for server in "public.easytier.top:11010" "turn.sc.629957.xyz:11010"; do
    echo "Testing $server"
    nc -zv ${server%:*} ${server#*:}
done

# 4. 路由跟踪
echo "4. 网络路径跟踪..."
traceroute public.easytier.top

# 5. 本地网络接口检查
echo "5. 本地网络接口状态..."
ip addr show

echo "=== 诊断完成 ==="
```

### 日志分析和调试

<Tabs>
  <TabItem label="Windows 日志">
    ```powershell
    # 查看 Astral 应用日志
    Get-EventLog -LogName Application | Where-Object {$_.Source -eq "Astral"}
    
    # 查看网络相关错误
    Get-EventLog -LogName System | Where-Object {$_.EntryType -eq "Error" -and $_.Message -like "*network*"}
    
    # 检查防火墙日志
    Get-WinEvent -LogName "Microsoft-Windows-Windows Firewall With Advanced Security/Firewall"
    ```
  </TabItem>

  <TabItem label="Linux 日志">
    ```bash
    # 查看系统网络日志
    journalctl -u NetworkManager --since "1 hour ago"
    
    # 查看应用日志
    tail -f ~/.local/share/astral/logs/*.log
    
    # 检查网络连接状态
    ss -tulpn | grep :11010
    
    # 查看 iptables 规则
    sudo iptables -L -n
    ```
  </TabItem>

  <TabItem label="网络抓包">
    ```bash
    # 使用 tcpdump 抓包分析
    sudo tcpdump -i any port 11010 -w astral-traffic.pcap
    
    # 使用 Wireshark 分析网络包
    # 过滤条件：port 11010 or host public.easytier.top
    
    # 分析连接建立过程
    sudo tcpdump -i any host public.easytier.top -v
    ```
  </TabItem>
</Tabs>

## 🆘 紧急处理方案

### 快速恢复连接

当遇到紧急连接问题时：

<Steps>
1. **立即重启应用**
   - 完全关闭 Astral
   - 等待 10 秒后重新启动

2. **切换网络环境**
   - 从 WiFi 切换到有线网络
   - 或使用手机热点测试

3. **更换服务器**
   - 选择延迟最低的备用服务器
   - 通知所有成员同步切换

4. **重置网络配置**
   - 清除应用数据和配置
   - 重新进行网络设置
</Steps>

### 联系技术支持

如果问题仍未解决：

1. **📋 收集信息**：
   - 网络环境描述
   - 错误信息截图
   - 操作系统和软件版本
   - 网络诊断结果

2. **🔍 搜索已知问题**：
   - GitHub Issues
   - 社区讨论区
   - 常见问题文档

3. **💬 寻求帮助**：
   - QQ 群：[加入链接]
   - GitHub Issue
   - 邮件支持

---

<Aside type="caution" title="重要提醒">
- 网络问题通常需要多方面排查
- 防火墙是最常见的连接障碍
- 服务器选择对连接质量影响很大
- 耐心测试不同的解决方案
</Aside>
